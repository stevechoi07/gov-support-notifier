<!DOCTYPE html>
<html lang="ko">
<head> 
<meta name="google-site-verification" content="ADUROtXWxHmlIj5mVDdy7TYwaYNCkSERuuqs3NEiiUc" />
<meta name="naver-site-verification" content="f390d10c4c9d8f9c62e98044c846495dbcaf2451" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>ì •ë¶€ ì§€ì›ì‚¬ì—… ì•Œë¦¬ë¯¸ | K-Startup ê³µê³ , ì²­ë…„ì°½ì—…, R&D ì§€ì›ê¸ˆ ì •ë³´</title>
    <meta name="description" content="ìµœì‹  ì •ë¶€ ì§€ì›ì‚¬ì—… ê³µê³ ë¥¼ í•œ ê³³ì—ì„œ í™•ì¸í•˜ì„¸ìš”. K-Startup, ì²­ë…„ì°½ì—…, ì†Œìƒê³µì¸, R&D ì§€ì›ê¸ˆ ë“± ë§ì¶¤í˜• í•„í„°ì™€ í‚¤ì›Œë“œ ì•Œë¦¼ìœ¼ë¡œ ë†“ì¹˜ì§€ ë§ˆì„¸ìš”.">
    <meta name="keywords" content="ì •ë¶€ì§€ì›ì‚¬ì—…, K-Startup, ì°½ì—…ì§€ì›, ì²­ë…„ì°½ì—…, ì†Œìƒê³µì¸ ì§€ì›, R&D, ì •ì±…ìê¸ˆ, ì§€ì›ê¸ˆ, ì‚¬ì—…ê³µê³ ">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; }
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #38bdf8; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .control-button.active { background-color: #0ea5e9; color: white; border-color: #0ea5e9; }
        .favorite-button.favorited { color: #f59e0b; }
        #toast-notification { transition: opacity 0.3s, transform 0.3s; }
        .new-badge { animation: pulse 1.5s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
        .details-content { max-height: 0; overflow: hidden; transition: max-height 0.5s ease-in-out; }
        .details-content.expanded { max-height: 500px; }
        .active-filter-tag, .keyword-tag { display: inline-flex; align-items: center; background-color: #e0f2fe; color: #075985; padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.875rem; }
        .active-filter-tag button, .keyword-tag button { margin-left: 0.5rem; color: #0ea5e9; font-weight: bold; }
        #collapsible-filters { max-height: 0; overflow: hidden; transition: max-height 0.5s ease-in-out; }
        #collapsible-filters.expanded { max-height: 1000px; }
        #keyword-alert-modal { transition: opacity 0.3s; }
        #keyword-alert-modal.hidden { opacity: 0; pointer-events: none; }
        .sticky-header {
            backdrop-filter: saturate(180%) blur(10px);
            -webkit-backdrop-filter: saturate(180%) blur(10px);
        }
        .ad-media-container {
            position: relative;
            width: 100%;
            padding-top: 56.25%; /* 16:9 ë¹„ìœ¨ */
            background-color: #e2e8f0;
        }
        .ad-media-container img,
        .ad-media-container video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .iframe-ad-wrapper {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
        }
        .iframe-ad-container {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
        }
        
        /* --- ìŠ¤ì¼ˆë ˆí†¤ UI ìŠ¤íƒ€ì¼ ì‹œì‘ --- */
        .skeleton-card {
            background-color: #fff;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            padding: 1.5rem;
            overflow: hidden;
        }
        .skeleton-line {
            background-color: #e2e8f0;
            border-radius: 0.25rem;
            animation: shimmer 1.5s infinite linear;
        }
        .skeleton-line.h-4 { height: 1rem; }
        .skeleton-line.h-6 { height: 1.5rem; }
        .skeleton-line.w-1-3 { width: 33.333333%; }
        .skeleton-line.w-1-4 { width: 25%; }
        .skeleton-line.w-full { width: 100%; }
        .skeleton-line.w-1-2 { width: 50%; }
        @keyframes shimmer {
            0% { background-position: -1000px 0; }
            100% { background-position: 1000px 0; }
        }
        .skeleton-line {
            background-image: linear-gradient(to right, #e2e8f0 0%, #f1f5f9 50%, #e2e8f0 100%);
            background-size: 2000px 100%;
        }
        /* --- ìŠ¤ì¼ˆë ˆí†¤ UI ìŠ¤íƒ€ì¼ ë --- */
    </style>
</head>
<body class="bg-slate-100">

    <div class="container mx-auto p-4 sm:p-6 md:p-8">
        
        <div class="bg-white/80 sticky-header rounded-xl shadow-lg p-4 sm:p-6 mb-8 sticky top-4 z-10">
            <header class="flex justify-between items-start mb-2">
                <button id="toggle-filters-button" class="p-1 rounded-md hover:bg-slate-200 transition-colors">
                    <svg class="w-9 h-9 text-slate-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
                </button>

                <div class="text-center -mt-1">
                    <h1 class="text-xl sm:text-2xl md:text-3xl font-bold text-slate-800 break-keep">ğŸš€ ì •ë¶€ ì§€ì›ì‚¬ì—… ì•Œë¦¬ë¯¸</h1>
                    <p class="text-slate-600 mt-2 text-sm md:text-base flex items-center justify-center flex-wrap gap-2">
                        <span>K-Startup, ì²­ë…„ì°½ì—…, R&D ì§€ì›ê¸ˆ</span>
                        <span class="text-xs font-semibold bg-sky-100 text-sky-800 px-2 py-1 rounded-full">v1.3</span>
                    </p>
                </div>

                <div class="w-11 h-11"></div>
            </header>

            <div class="relative flex-grow mb-4">
                <input type="text" id="search-input" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”" class="w-full pl-10 pr-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-sky-500">
                <svg class="w-5 h-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
            </div>
            <div id="collapsible-filters" class="space-y-4">
                <div id="sort-buttons" class="flex flex-wrap gap-2 items-center justify-center pt-4 border-t">
                    <button data-sort="default" class="control-button active px-4 py-2 border border-slate-300 rounded-lg text-sm font-semibold hover:bg-slate-200 transition-colors">ê¸°ë³¸ìˆœ</button>
                    <button data-sort="deadline" class="control-button px-4 py-2 border border-slate-300 rounded-lg text-sm font-semibold hover:bg-slate-200 transition-colors">ë§ˆê° ì„ë°•ìˆœ</button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 pt-4 border-t">
                    <div>
                        <label for="region-select" class="text-sm font-semibold text-slate-500 mb-2 block">ì§€ì—­</label>
                        <select id="region-select" class="w-full p-2 border rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-sky-500">
                            <option value="all">ëª¨ë“  ì§€ì—­</option>
                        </select>
                    </div>
                    <div>
                        <label class="text-sm font-semibold text-slate-500 mb-2 block">ì‚¬ì—…ë¶„ì•¼ (ì¤‘ë³µ ê°€ëŠ¥)</label>
                        <div id="category-checkbox-container" class="max-h-40 overflow-y-auto space-y-2 p-2 border rounded-lg bg-white">
                        </div>
                    </div>
                </div>
                <div class="pt-4 border-t">
                     <h3 class="text-sm font-semibold text-slate-500 mb-2">í‚¤ì›Œë“œ ì•Œë¦¼ ì„¤ì •</h3>
                     <div class="flex gap-2">
                         <input type="text" id="keyword-input" placeholder="ì•Œë¦¼ë°›ì„ í‚¤ì›Œë“œ ì…ë ¥" class="flex-grow min-w-0 px-3 py-1 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-sky-500">
                         <button id="add-keyword-button" class="px-4 py-1 bg-sky-500 text-white rounded-lg text-sm font-semibold hover:bg-sky-600 shadow-md transition-colors">ì¶”ê°€</button>
                     </div>
                     <div id="keyword-tags-container" class="flex flex-wrap gap-2 mt-2 min-h-[34px]"></div>
                </div>
                <div id="active-filters-container" class="flex flex-wrap gap-2 items-center pt-4 border-t min-h-[41px]"></div>
            </div>
            <div class="mt-4 text-center">
                 <button id="compare-button" class="control-button w-full px-4 py-2 bg-green-500 text-white rounded-lg text-sm font-semibold hover:bg-green-600 shadow-md transition-colors hidden">ğŸ“‹ ì„ íƒ í•­ëª© ë¹„êµí•˜ê¸°</button>
            </div>
            <div class="mt-2 text-center">
                <button id="favorites-toggle" class="control-button w-full px-4 py-2 bg-amber-400 text-white rounded-lg text-sm font-semibold hover:bg-amber-500 shadow-md transition-colors hidden">â˜† ì¦ê²¨ì°¾ê¸° ë³´ê¸°</button>
            </div>
        </div>

        <div id="status-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <div class="skeleton-card space-y-4">
                <div class="flex justify-between items-center">
                    <div class="skeleton-line h-4 w-1/3"></div>
                    <div class="skeleton-line h-4 w-1/4"></div>
                </div>
                <div class="skeleton-line h-6 w-full"></div>
                <div class="skeleton-line h-4 w-1/2"></div>
                <div class="border-t pt-4 mt-4 flex justify-between items-center">
                    <div class="skeleton-line h-4 w-1/4"></div>
                    <div class="skeleton-line h-4 w-1/4"></div>
                </div>
            </div>
            <div class="skeleton-card space-y-4 hidden md:block">
                <div class="flex justify-between items-center">
                    <div class="skeleton-line h-4 w-1/3"></div>
                    <div class="skeleton-line h-4 w-1/4"></div>
                </div>
                <div class="skeleton-line h-6 w-full"></div>
                <div class="skeleton-line h-4 w-1/2"></div>
                <div class="border-t pt-4 mt-4 flex justify-between items-center">
                    <div class="skeleton-line h-4 w-1/4"></div>
                    <div class="skeleton-line h-4 w-1/4"></div>
                </div>
            </div>
            <div class="skeleton-card space-y-4 hidden lg:block">
                <div class="flex justify-between items-center">
                    <div class="skeleton-line h-4 w-1/3"></div>
                    <div class="skeleton-line h-4 w-1/4"></div>
                </div>
                <div class="skeleton-line h-6 w-full"></div>
                <div class="skeleton-line h-4 w-1/2"></div>
                <div class="border-t pt-4 mt-4 flex justify-between items-center">
                    <div class="skeleton-line h-4 w-1/4"></div>
                    <div class="skeleton-line h-4 w-1/4"></div>
                </div>
            </div>
            <div id="error-message" class="hidden col-span-full text-center"></div>
        </div>

        <main id="results-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></main>
        
        <div id="load-more-spinner" class="text-center mt-8 hidden">
            <div class="loader mx-auto"></div>
        </div>

        <footer class="text-center mt-12 text-sm text-slate-500">
            <p>ë³¸ ë°ì´í„°ëŠ” ê³µê³µë°ì´í„°í¬í„¸(K-Startup) APIë¥¼ í†µí•´ ì œê³µë°›ì•˜ìŠµë‹ˆë‹¤.</p>
            <a href="admin.html" target="_blank" class="text-sky-600 hover:underline mt-2 inline-block">admin</a>
        </footer>
    </div>

    <div id="comparison-modal" class="fixed inset-0 z-50 hidden"><div id="comparison-modal-bg" class="absolute inset-0 bg-black bg-opacity-50"></div><div class="relative bg-white rounded-lg shadow-xl m-4 md:m-8 max-w-6xl mx-auto max-h-[90vh] flex flex-col"><div class="flex justify-between items-center p-4 border-b"><h2 class="text-xl font-bold">ì§€ì›ì‚¬ì—… ë¹„êµí•˜ê¸°</h2><button id="close-modal-button" class="text-2xl">&times;</button></div><div id="comparison-content" class="p-4 overflow-auto"></div></div></div>
    <div id="toast-notification" class="fixed bottom-10 right-10 bg-slate-800 text-white px-6 py-3 rounded-lg shadow-lg opacity-0 transform translate-y-4">ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!</div>
    <div id="keyword-alert-modal" class="fixed inset-0 z-50 hidden bg-black bg-opacity-50 flex justify-center items-center"><div class="bg-white rounded-lg shadow-xl m-4 max-w-lg w-full"><div class="flex justify-between items-center p-4 border-b bg-sky-500 text-white rounded-t-lg"><h2 class="text-xl font-bold">ğŸ”” ìƒˆë¡œìš´ í‚¤ì›Œë“œ ê³µê³  ì•Œë¦¼!</h2><button id="close-keyword-alert-button" class="text-2xl">&times;</button></div><div id="keyword-alert-content" class="p-6 max-h-[60vh] overflow-y-auto"></div></div></div>
    
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
      import { getFirestore, collection, getDocs, query, orderBy, doc, updateDoc, increment } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";

      // ===============================================================
      // ğŸš€ ì •ë¶€ ì§€ì›ì‚¬ì—… ì•Œë¦¬ë¯¸ v1.3
      // ===============================================================
      // [ë³€ê²½ì ]
      // 1. í˜ì´ì§€ë„¤ì´ì…˜ & ì„œë²„ì‚¬ì´ë“œ í•„í„°ë§ ë„ì…!
      // 2. ì´ˆê¸° ë¡œë”© ì‹œ ëª¨ë“  ë°ì´í„°ë¥¼ ë°›ì§€ ì•Šê³ , ì²« í˜ì´ì§€ë§Œí¼ë§Œ ìš”ì²­í•˜ì—¬ ë¡œë”© ì†ë„ ê·¹ì  ê°œì„ .
      // 3. í•„í„° ë³€ê²½ ì‹œ, ë°±ì—”ë“œì— ìƒˆë¡œìš´ ì¡°ê±´ìœ¼ë¡œ ë°ì´í„°ë¥¼ ë‹¤ì‹œ ìš”ì²­í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ë³€ê²½.
      // 4. ë””ë²„ê¹…ì„ ìœ„í•œ console.log ì¶”ê°€!
      // ===============================================================

      let db;

      // --- JavaScript ì½”ë“œ ì‹œì‘ ---
      // ìƒíƒœ ê´€ë¦¬ ë³€ìˆ˜
      let favorites = [], comparisonList = [], alertKeywords = [], seenItems = [], adDataList = [], allApiDataForFilterPopulation = [];
      let currentFilters = { searchTerm: '', region: 'all', category: [], sort: 'default', showFavorites: false };
      let currentPage = 1;
      let totalItems = 0;
      let isLoading = false;
      let searchTimeout;

      // DOM ìš”ì†Œ
      const elements = { 
          statusContainer: document.getElementById('status-container'), 
          errorMessage: document.getElementById('error-message'), 
          resultsContainer: document.getElementById('results-container'), 
          searchInput: document.getElementById('search-input'), 
          sortButtons: document.getElementById('sort-buttons'),
          regionSelect: document.getElementById('region-select'), 
          categoryCheckboxContainer: document.getElementById('category-checkbox-container'), 
          activeFiltersContainer: document.getElementById('active-filters-container'), 
          favoritesToggle: document.getElementById('favorites-toggle'), 
          compareButton: document.getElementById('compare-button'), 
          loadMoreSpinner: document.getElementById('load-more-spinner'),
          modal: document.getElementById('comparison-modal'), 
          modalBg: document.getElementById('comparison-modal-bg'), 
          closeModalButton: document.getElementById('close-modal-button'), 
          comparisonContent: document.getElementById('comparison-content'), 
          toast: document.getElementById('toast-notification'), 
          toggleFiltersButton: document.getElementById('toggle-filters-button'), 
          collapsibleFilters: document.getElementById('collapsible-filters'),
          keywordInput: document.getElementById('keyword-input'), 
          addKeywordButton: document.getElementById('add-keyword-button'), 
          keywordTagsContainer: document.getElementById('keyword-tags-container'), 
          keywordAlertModal: document.getElementById('keyword-alert-modal'), 
          keywordAlertContent: document.getElementById('keyword-alert-content'), 
          closeKeywordAlertButton: document.getElementById('close-keyword-alert-button'),
      };
      
      // --- ì•± ì‹œì‘ì  ---
      document.addEventListener('DOMContentLoaded', startApp);

      async function startApp() {
        try {
            console.log("ğŸš€ [v1.3] ì•± ì‹¤í–‰ ì‹œì‘!");
            const response = await fetch('/.netlify/functions/get-firebase-config');
            if (!response.ok) throw new Error(`ë¹„ë°€ìš”ì› ì‘ë‹µ ì‹¤íŒ¨! ìƒíƒœ: ${response.status}`);
            const firebaseConfig = await response.json();
            
            const app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            console.log("âœ… [v1.3] Firebase ì•± ì´ˆê¸°í™” ë° Firestore DB ì—°ê²° ì„±ê³µ!");

            await initialize();
        } catch (error) {
            handleError("ğŸ”¥ [ì¹˜ëª…ì  ì˜¤ë¥˜] ì•± ì‹œì‘ ì¤‘ ë¬¸ì œ ë°œìƒ:", error.message);
        }
      }

      async function initialize() {
          addEventListeners();
          
          // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ì‚¬ìš©ì ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
          favorites = JSON.parse(localStorage.getItem('favorites')) || [];
          alertKeywords = JSON.parse(localStorage.getItem('alertKeywords')) || [];
          seenItems = JSON.parse(localStorage.getItem('seenItems')) || [];
          
          updateFavoritesButtonVisibility(); 
          renderAlertKeywords();
          
          // í•„í„° ì˜µì…˜(ì§€ì—­, ì¹´í…Œê³ ë¦¬)ì„ ì±„ìš°ê¸° ìœ„í•´ ëª¨ë“  ë°ì´í„°ë¥¼ í•œë²ˆ ê°€ì ¸ì˜´
          await populateFilters();
          
          // ì²« í˜ì´ì§€ ë°ì´í„° ë¡œë”©
          await fetchAndRenderData(true);
      }

      // --- ë°ì´í„° ìš”ì²­ ë° ë Œë”ë§ ---
      async function fetchAndRenderData(isNewSearch = false) {
          if (isLoading) return;
          isLoading = true;

          if (isNewSearch) {
              currentPage = 1;
              elements.resultsContainer.innerHTML = '';
              elements.statusContainer.classList.remove('hidden'); // ìƒˆ ê²€ìƒ‰ ì‹œ ìŠ¤ì¼ˆë ˆí†¤ ë³´ì´ê¸°
              elements.errorMessage.classList.add('hidden');
          } else {
              elements.loadMoreSpinner.classList.remove('hidden'); // ë”ë³´ê¸° ì‹œ ìŠ¤í”¼ë„ˆ ë³´ì´ê¸°
          }
          
          // ë°±ì—”ë“œë¡œ ë³´ë‚¼ ì¿¼ë¦¬ ë¬¸ìì—´ ìƒì„±
          let query = `page=${currentPage}&perPage=12`;
          if (currentFilters.searchTerm) query += `&searchTerm=${encodeURIComponent(currentFilters.searchTerm)}`;
          if (currentFilters.region !== 'all') query += `&region=${encodeURIComponent(currentFilters.region)}`;
          if (currentFilters.category.length > 0) query += `&category=${encodeURIComponent(currentFilters.category.join(','))}`;
          // ì •ë ¬(sort)ì€ ì•„ì§ ì„œë²„ì—ì„œ êµ¬í˜„ë˜ì§€ ì•Šì•˜ìœ¼ë¯€ë¡œ ì¶”í›„ ì¶”ê°€
          
          console.log(`[v1.3 í”„ë¡ íŠ¸ì—”ë“œ] ğŸ“¡ ë°±ì—”ë“œì— ë°ì´í„° ìš”ì²­ ì‹œì‘... ì¡°ê±´: ${query}`);

          try {
              const response = await fetch(`/.netlify/functions/get-support-data?${query}`);
              if (!response.ok) throw new Error(`ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜: ${response.status}`);
              
              const { data, totalItems: newTotalItems } = await response.json();
              console.log(`[v1.3 í”„ë¡ íŠ¸ì—”ë“œ] âœ… ë°±ì—”ë“œë¡œë¶€í„° ì‘ë‹µ ìˆ˜ì‹ !`, { data, newTotalItems });
              
              totalItems = newTotalItems;

              if (data && data.length > 0) {
                  appendData(data);
              } else if (isNewSearch) {
                  elements.resultsContainer.innerHTML = `<p class="col-span-full text-center text-slate-500">ì¡°ê±´ì— ë§ëŠ” ì‚¬ì—…ì´ ì—†ìŠµë‹ˆë‹¤.</p>`;
              }
              
              renderActiveFilters();

          } catch (error) {
              handleError("ë°ì´í„° ìš”ì²­ ì˜¤ë¥˜:", error.message);
          } finally {
              isLoading = false;
              elements.statusContainer.classList.add('hidden');
              elements.loadMoreSpinner.classList.add('hidden');
          }
      }

      function appendData(items) {
          const newContent = items.map(createItemHTML).join('');
          elements.resultsContainer.insertAdjacentHTML('beforeend', newContent);
      }
      
      async function populateFilters() {
            // í•„í„° UIë¥¼ ì±„ìš°ê¸° ìœ„í•´ í•œë²ˆë§Œ ëª¨ë“  ë°ì´í„°ë¥¼ ìš”ì²­
            try {
                const response = await fetch(`/.netlify/functions/get-support-data?perPage=500`);
                 if (!response.ok) throw new Error(`í•„í„° ë°ì´í„° ë¡œë”© ì‹¤íŒ¨: ${response.status}`);
                 const result = await response.json();
                 allApiDataForFilterPopulation = result.data || [];

                const regionCounts = {}, categoryCounts = {};
                allApiDataForFilterPopulation.forEach(item => {
                    if (item.supt_regin) regionCounts[item.supt_regin] = (regionCounts[item.supt_regin] || 0) + 1;
                    if (item.supt_biz_clsfc) categoryCounts[item.supt_biz_clsfc] = (categoryCounts[item.supt_biz_clsfc] || 0) + 1;
                });

                elements.regionSelect.innerHTML = '<option value="all">ëª¨ë“  ì§€ì—­ ('+ allApiDataForFilterPopulation.length +')</option>';
                const sortedRegions = Object.keys(regionCounts).sort((a, b) => a.localeCompare(b, 'ko'));
                for (const region of sortedRegions) {
                    const count = regionCounts[region];
                    const option = document.createElement('option');
                    option.value = region;
                    option.textContent = `${region} (${count})`;
                    elements.regionSelect.appendChild(option);
                }

                elements.categoryCheckboxContainer.innerHTML = '';
                const sortedCategories = Object.keys(categoryCounts).sort((a, b) => a.localeCompare(b, 'ko'));
                for (const category of sortedCategories) {
                    const count = categoryCounts[category];
                    let displayText = category.includes('ê¸°ìˆ ê°œë°œ(R&D)') ? 'ê¸°ìˆ ê°œë°œ' : category;
                    
                    const label = document.createElement('label');
                    label.className = 'flex items-center space-x-2 text-sm cursor-pointer hover:bg-sky-50 p-1 rounded';
                    label.innerHTML = `
                        <input type="checkbox" class="category-checkbox rounded border-gray-300 text-sky-600 shadow-sm focus:border-sky-300 focus:ring focus:ring-offset-0 focus:ring-sky-200 focus:ring-opacity-50" value="${category}">
                        <span>${displayText} (${count})</span>
                    `;
                    elements.categoryCheckboxContainer.appendChild(label);
                }
            } catch(error) {
                console.error("í•„í„° UI ìƒì„± ì‹¤íŒ¨", error);
                // ì‹¤íŒ¨í•´ë„ ì•±ì´ ë©ˆì¶”ì§€ ì•Šë„ë¡ ì²˜ë¦¬
            }
        }

      // --- ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ---
      function addEventListeners() {
          window.addEventListener('scroll', handleScroll);
          
          elements.searchInput.addEventListener('input', e => {
              clearTimeout(searchTimeout);
              searchTimeout = setTimeout(() => {
                  console.log(`[v1.3 í”„ë¡ íŠ¸ì—”ë“œ] ğŸ” ê²€ìƒ‰ í•„í„° ì ìš©! ê²€ìƒ‰ì–´: ${e.target.value}`);
                  currentFilters.searchTerm = e.target.value.toLowerCase();
                  fetchAndRenderData(true);
              }, 300);
          });

          elements.regionSelect.addEventListener('change', e => {
              console.log(`[v1.3 í”„ë¡ íŠ¸ì—”ë“œ] ğŸŒ ì§€ì—­ í•„í„° ì ìš©! ì§€ì—­: ${e.target.value}`);
              currentFilters.region = e.target.value;
              fetchAndRenderData(true);
          });
          
          elements.categoryCheckboxContainer.addEventListener('change', e => {
              if (e.target.classList.contains('category-checkbox')) {
                  const checkedCategories = Array.from(elements.categoryCheckboxContainer.querySelectorAll('.category-checkbox:checked')).map(cb => cb.value);
                  console.log(`[v1.3 í”„ë¡ íŠ¸ì—”ë“œ] ğŸ“‚ ì¹´í…Œê³ ë¦¬ í•„í„° ì ìš©!`, checkedCategories);
                  currentFilters.category = checkedCategories;
                  fetchAndRenderData(true);
              }
          });
          
           elements.resultsContainer.addEventListener('click', e => {
                const target = e.target;
                const button = target.closest('button');
                if (button) {
                    if (button.classList.contains('favorite-button')) toggleFavorite(button);
                    if (button.classList.contains('share-button')) shareLink(button);
                    if (button.classList.contains('details-toggle')) toggleDetails(button);
                }
                const checkbox = target.closest('.compare-checkbox');
                if (checkbox) toggleComparison(checkbox);
            });

            elements.compareButton.addEventListener('click', showComparisonModal);
            elements.modalBg.addEventListener('click', () => elements.modal.classList.add('hidden'));
            elements.closeModalButton.addEventListener('click', () => elements.modal.classList.add('hidden'));
            elements.toggleFiltersButton.addEventListener('click', () => elements.collapsibleFilters.classList.toggle('expanded'));
            elements.addKeywordButton.addEventListener('click', addKeyword);
            elements.keywordInput.addEventListener('keypress', e => { if (e.key === 'Enter') addKeyword(); });
            elements.keywordTagsContainer.addEventListener('click', handleKeywordTagClick);
            elements.closeKeywordAlertButton.addEventListener('click', () => elements.keywordAlertModal.classList.add('hidden'));
      }

      function handleScroll() {
          const { scrollTop, scrollHeight, clientHeight } = document.documentElement;
          const itemsRendered = elements.resultsContainer.children.length;

          // ìŠ¤í¬ë¡¤ì´ í•˜ë‹¨ì— ê°€ê¹ê³ , ë¡œë”© ì¤‘ì´ ì•„ë‹ˆë©°, ì•„ì§ ë¶ˆëŸ¬ì˜¬ ì•„ì´í…œì´ ë‚¨ì•˜ì„ ë•Œ
          if (clientHeight + scrollTop >= scrollHeight - 100 && !isLoading && itemsRendered < totalItems) {
              console.log(`[v1.3 í”„ë¡ íŠ¸ì—”ë“œ] ğŸ“œ ìŠ¤í¬ë¡¤ ê°ì§€! ë‹¤ìŒ í˜ì´ì§€(${currentPage + 1}) ë¡œë”©...`);
              currentPage++;
              fetchAndRenderData(false);
          }
      }

      function handleError(context, message) {
          console.error(context, message);
          elements.statusContainer.classList.add('hidden');
          elements.loadMoreSpinner.classList.add('hidden');
          elements.errorMessage.textContent = `${context} ${message}`;
          elements.errorMessage.classList.remove('hidden');
      }

      // --- UI ë Œë”ë§ ë° ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ---
      function createItemHTML(item) {
          const dday = calculateDday(item.pbanc_rcpt_end_dt); 
          const isFavorited = favorites.includes(item.pbanc_sn); 
          const isChecked = comparisonList.includes(item.pbanc_sn) ? 'checked' : ''; 
          const isNew = isWithinLast7Days(item.pbanc_rcpt_bgng_dt); 
          return `
              <div class="bg-white rounded-xl shadow-md hover:shadow-lg transition-shadow overflow-hidden relative">
                  ${isNew ? '<span class="new-badge absolute top-0 right-0 bg-red-500 text-white text-xs font-bold px-2 py-1 rounded-bl-lg">NEW</span>' : ''}
                  <div class="p-6">
                      <div class="flex justify-between items-start">
                          <span class="text-sm font-semibold text-sky-600 uppercase tracking-wide">${item.pbanc_ntrp_nm || 'ê¸°ê´€ëª… ì—†ìŒ'}</span>
                          <span class="text-white text-xs font-bold rounded-full px-3 py-1 ${dday.className}">${dday.text}</span>
                      </div>
                      <a href="${item.detl_pg_url}" target="_blank" class="block mt-2 text-xl leading-tight font-bold text-slate-800 hover:underline">${item.biz_pbanc_nm || 'ê³µê³  ì œëª© ì—†ìŒ'}</a>
                      <p class="mt-2 text-slate-500 text-sm"><strong>ì ‘ìˆ˜ê¸°ê°„:</strong> ${item.pbanc_rcpt_bgng_dt || '?'} ~ ${item.pbanc_rcpt_end_dt || '?'}</p>
                      <div class="details-content mt-4 pt-4 border-t text-sm text-slate-600 space-y-2">
                          <p><strong>- ì‹ ì²­ëŒ€ìƒ:</strong> ${item.aply_trgt_ctnt || 'ìƒì„¸ ì •ë³´ ì—†ìŒ'}</p>
                      </div>
                      <div class="flex justify-between items-center mt-4 pt-4 border-t">
                          <div class="flex items-center gap-4">
                              <label class="flex items-center space-x-2 text-sm cursor-pointer">
                                  <input type="checkbox" class="compare-checkbox" data-id="${item.pbanc_sn}" ${isChecked}>
                                  <span>ë¹„êµ</span>
                              </label>
                              <button class="details-toggle text-sm font-semibold text-sky-600 hover:underline">ìì„¸íˆ ë³´ê¸° â–¼</button>
                          </div>
                          <div>
                              <button class="share-button text-slate-400 hover:text-sky-500 transition-colors" data-url="${item.detl_pg_url}" title="ê³µìœ í•˜ê¸°">
                                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12s-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6.002l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.318a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"></path></svg>
                              </button>
                              <button class="favorite-button text-2xl text-slate-400 hover:text-amber-400 transition-colors ${isFavorited ? 'favorited' : ''}" data-id="${item.pbanc_sn}">${isFavorited ? 'â˜…' : 'â˜†'}</button>
                          </div>
                      </div>
                  </div>
              </div>`;
      }
      
      function renderActiveFilters() {
          let html = ''; 
          if (currentFilters.searchTerm) html += `<span class="active-filter-tag" data-type="searchTerm">ê²€ìƒ‰: ${currentFilters.searchTerm} <button>x</button></span>`; 
          if (currentFilters.region !== 'all') html += `<span class="active-filter-tag" data-type="region">ì§€ì—­: ${currentFilters.region} <button>x</button></span>`; 
          
          if (currentFilters.category.length > 0) {
              currentFilters.category.forEach(cat => {
                  html += `<span class="active-filter-tag" data-type="category" data-value="${cat}">ë¶„ì•¼: ${cat} <button>x</button></span>`;
              });
          }

          if (html) { 
              html += `<button id="reset-filters-button" class="text-sm text-red-500 hover:underline ml-auto">ëª¨ë“  í•„í„° ì´ˆê¸°í™”</button>`; 
          } 
          elements.activeFiltersContainer.innerHTML = html; 
          
          elements.activeFiltersContainer.querySelectorAll('.active-filter-tag button').forEach(btn => btn.addEventListener('click', e => { 
              const tagElement = e.target.parentElement;
              const type = tagElement.dataset.type; 
              const value = tagElement.dataset.value; 
              resetFilter(type, value); 
          })); 
          if(document.getElementById('reset-filters-button')) { 
              document.getElementById('reset-filters-button').addEventListener('click', resetAllFilters); 
          } 
      }

      function resetFilter(type, value) {
          if (type === 'searchTerm') {
              currentFilters.searchTerm = ''; 
              elements.searchInput.value = '';
          } else if (type === 'region') {
              currentFilters.region = 'all'; 
              elements.regionSelect.value = 'all';
          } else if (type === 'category') {
              currentFilters.category = currentFilters.category.filter(cat => cat !== value);
              const checkboxToUncheck = elements.categoryCheckboxContainer.querySelector(`.category-checkbox[value="${value}"]`);
              if (checkboxToUncheck) checkboxToUncheck.checked = false;
          }
          fetchAndRenderData(true);
      }

      function resetAllFilters() {
          currentFilters = { searchTerm: '', region: 'all', category: [], sort: 'default', showFavorites: false };
          elements.searchInput.value = ''; 
          elements.regionSelect.value = 'all';
          elements.categoryCheckboxContainer.querySelectorAll('.category-checkbox:checked').forEach(checkbox => checkbox.checked = false);
          fetchAndRenderData(true);
      }
      
      function calculateDday(endDateStr) { if (!endDateStr) return { text: "ì •ë³´ ì—†ìŒ", className: "bg-slate-500", days: 9999 }; const year = parseInt(endDateStr.substring(0, 4)), month = parseInt(endDateStr.substring(4, 6)) - 1, day = parseInt(endDateStr.substring(6, 8)); const today = new Date(); today.setHours(0, 0, 0, 0); const endDate = new Date(year, month, day); const diffDays = Math.ceil((endDate - today) / (1000 * 60 * 60 * 24)); if (diffDays < 0) return { text: "ë§ˆê°", className: "bg-slate-700", days: 9999 + diffDays }; if (diffDays === 0) return { text: "D-Day", className: "bg-red-500", days: 0 }; if (diffDays <= 7) return { text: `D-${diffDays}`, className: "bg-orange-500", days: diffDays }; return { text: `D-${diffDays}`, className: "bg-green-600", days: diffDays }; }
      function isWithinLast7Days(dateStr) { if (!dateStr) return false; const year = parseInt(dateStr.substring(0, 4)), month = parseInt(dateStr.substring(4, 6)) - 1, day = parseInt(dateStr.substring(6, 8)); const itemDate = new Date(year, month, day); const today = new Date(); const sevenDaysAgo = new Date(); sevenDaysAgo.setDate(today.getDate() - 7); return itemDate >= sevenDaysAgo && itemDate <= today; }
      function toggleDetails(button) { const content = button.closest('.p-6').querySelector('.details-content'); content.classList.toggle('expanded'); button.textContent = content.classList.contains('expanded') ? 'ê°„ëµíˆ ë³´ê¸° â–²' : 'ìì„¸íˆ ë³´ê¸° â–¼'; }
      function toggleFavorite(button) { const id = parseInt(button.dataset.id); const index = favorites.indexOf(id); if (index > -1) { favorites.splice(index, 1); button.classList.remove('favorited'); button.textContent = 'â˜†'; } else { favorites.push(id); button.classList.add('favorited'); button.textContent = 'â˜…'; } localStorage.setItem('favorites', JSON.stringify(favorites)); updateFavoritesButtonVisibility(); }
      function toggleComparison(checkbox) { const id = parseInt(checkbox.dataset.id); const index = comparisonList.indexOf(id); if (index > -1) { comparisonList.splice(index, 1); } else { comparisonList.push(id); } elements.compareButton.classList.toggle('hidden', comparisonList.length === 0); }
      function updateFavoritesButtonVisibility() { elements.favoritesToggle.classList.toggle('hidden', favorites.length === 0); if (favorites.length === 0 && currentFilters.showFavorites) { currentFilters.showFavorites = false; elements.favoritesToggle.classList.remove('active'); elements.favoritesToggle.innerHTML = 'â˜† ì¦ê²¨ì°¾ê¸° ë³´ê¸°'; fetchAndRenderData(true); } }
      function showComparisonModal() { const itemsToCompare = allApiDataForFilterPopulation.filter(item => comparisonList.includes(item.pbanc_sn)); const headers = { biz_pbanc_nm: "ê³µê³  ì œëª©", pbanc_ntrp_nm: "ì£¼ê´€ ê¸°ê´€", supt_regin: "ì§€ì› ì§€ì—­", supt_biz_clsfc: "ì‚¬ì—… ë¶„ì•¼", aply_trgt_ctnt: "ì‹ ì²­ ëŒ€ìƒ" }; let tableHTML = '<div class="overflow-x-auto"><table class="w-full text-sm text-left table-fixed"><thead><tr class="bg-slate-100"><th class="p-2 w-1/5">í•­ëª©</th>'; itemsToCompare.forEach(item => tableHTML += `<th class="p-2 w-2/5">${(item.biz_pbanc_nm || '').substring(0, 20)}...</th>`); tableHTML += '</tr></thead><tbody>'; Object.keys(headers).forEach(key => { tableHTML += `<tr class="border-b"><td class="font-bold p-2 align-top">${headers[key]}</td>`; itemsToCompare.forEach(item => tableHTML += `<td class="p-2 align-top break-words">${item[key] || '-'}</td>`); tableHTML += '</tr>'; }); tableHTML += '</tbody></table></div>'; elements.comparisonContent.innerHTML = tableHTML; elements.modal.classList.remove('hidden'); }
      function shareLink(button) { const url = button.dataset.url; const textArea = document.createElement("textarea"); textArea.value = url; document.body.appendChild(textArea); textArea.focus(); textArea.select(); try { document.execCommand('copy'); showToast("ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!"); } catch (err) { showToast("ë§í¬ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.", true); } document.body.removeChild(textArea); }
      function showToast(message, isError = false) { elements.toast.textContent = message; elements.toast.className = `fixed bottom-10 right-10 text-white px-6 py-3 rounded-lg shadow-lg opacity-0 transform translate-y-4 ${isError ? 'bg-red-500' : 'bg-slate-800'}`; elements.toast.classList.remove('opacity-0', 'translate-y-4'); setTimeout(() => { elements.toast.classList.add('opacity-0', 'translate-y-4'); }, 2000); }
      function addKeyword() { const keyword = elements.keywordInput.value.trim(); if (keyword && !alertKeywords.includes(keyword)) { alertKeywords.push(keyword); localStorage.setItem('alertKeywords', JSON.stringify(alertKeywords)); renderAlertKeywords(); elements.keywordInput.value = ''; } }
      function renderAlertKeywords() { if (alertKeywords.length === 0) { elements.keywordTagsContainer.innerHTML = '<span class="text-xs text-slate-400">ì•Œë¦¼ ë°›ì„ í‚¤ì›Œë“œë¥¼ ì¶”ê°€í•´ë³´ì„¸ìš”.</span>'; return; } elements.keywordTagsContainer.innerHTML = alertKeywords.map((keyword, index) => ` <span class="keyword-tag">${keyword} <button data-index="${index}">x</button></span> `).join(''); }
      function handleKeywordTagClick(e) { if (e.target.tagName === 'BUTTON') { const index = parseInt(e.target.dataset.index); alertKeywords.splice(index, 1); localStorage.setItem('alertKeywords', JSON.stringify(alertKeywords)); renderAlertKeywords(); } }
      function checkNewItemsForKeywords() { if (alertKeywords.length === 0 || allApiDataForFilterPopulation.length === 0) return; const currentItemIds = allApiDataForFilterPopulation.map(item => item.pbanc_sn); const newItems = allApiDataForFilterPopulation.filter(item => !seenItems.includes(item.pbanc_sn)); if (newItems.length > 0) { const matchedItems = []; newItems.forEach(item => { const title = item.biz_pbanc_nm || ''; const matchedKeyword = alertKeywords.find(keyword => title.toLowerCase().includes(keyword.toLowerCase())); if (matchedKeyword) { matchedItems.push({ item, keyword: matchedKeyword }); } }); if (matchedItems.length > 0) { showKeywordAlertDialog(matchedItems); } } localStorage.setItem('seenItems', JSON.stringify(currentItemIds)); seenItems = currentItemIds; }
      function showKeywordAlertDialog(matchedItems) { elements.keywordAlertContent.innerHTML = matchedItems.map(({item, keyword}) => ` <div class="mb-4 p-3 border rounded-lg hover:bg-slate-50"> <p class="text-sm text-slate-500"> <span class="font-bold text-sky-600">[${keyword}]</span> í‚¤ì›Œë“œì™€ ì¼ì¹˜í•˜ëŠ” ìƒˆ ê³µê³ ! </p> <a href="${item.detl_pg_url}" target="_blank" class="font-bold text-slate-800 hover:underline">${item.biz_pbanc_nm}</a> </div> `).join(''); elements.keywordAlertModal.classList.remove('hidden'); }
      
    </script>
</body>
</html>