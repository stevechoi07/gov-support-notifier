<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì •ë¶€ ì§€ì›ì‚¬ì—… ì•Œë¦¬ë¯¸ v10.8 - ë¯¸ë‹ˆë©€ UI</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; }
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .control-button.active { background-color: #4f46e5; color: white; border-color: #4f46e5; }
        .favorite-button.favorited { color: #f59e0b; }
        #toast-notification { transition: opacity 0.3s, transform 0.3s; }
        .new-badge { animation: pulse 1.5s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
        .details-content { max-height: 0; overflow: hidden; transition: max-height 0.5s ease-in-out; }
        .details-content.expanded { max-height: 500px; }
        .active-filter-tag, .keyword-tag { display: inline-flex; align-items: center; background-color: #e0e7ff; color: #3730a3; padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.875rem; }
        .active-filter-tag button, .keyword-tag button { margin-left: 0.5rem; color: #4f46e5; font-weight: bold; }
        #collapsible-filters { max-height: 0; overflow: hidden; transition: max-height 0.5s ease-in-out; }
        #collapsible-filters.expanded { max-height: 1000px; }
        #keyword-alert-modal { transition: opacity 0.3s; }
        #keyword-alert-modal.hidden { opacity: 0; pointer-events: none; }
    </style>
</head>
<body class="bg-gray-100">

    <div class="container mx-auto p-4 sm:p-6 md:p-8">
        
        <div class="bg-white rounded-xl shadow-md p-4 sm:p-6 mb-8 sticky top-4 z-10">
            <header class="text-center mb-6">
                <h1 class="text-2xl md:text-3xl font-bold text-gray-800">ğŸš€ ì •ë¶€ ì§€ì›ì‚¬ì—… ì•Œë¦¬ë¯¸ v10.8</h1>
                <p class="text-gray-600 mt-2">ê¹”ë”í•´ì§„ í•„í„°ë¡œ ë” í¸ë¦¬í•˜ê²Œ ì°¾ì•„ë³´ì„¸ìš”!</p>
            </header>

            <!-- ê²€ìƒ‰ì°½ -->
            <div class="relative flex-grow mb-4">
                <input type="text" id="search-input" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”" class="w-full pl-10 pr-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                <svg class="w-5 h-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
            </div>
            
            <!-- ìƒì„¸ í•„í„° ì„œë -->
            <div id="collapsible-filters" class="space-y-4">
                <!-- ë“œë¡­ë‹¤ìš´ í•„í„° -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 pt-4 border-t">
                    <div>
                        <label for="region-select" class="text-sm font-semibold text-gray-500 mb-2 block">ì§€ì—­</label>
                        <select id="region-select" class="w-full p-2 border rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            <option value="all">ëª¨ë“  ì§€ì—­</option>
                        </select>
                    </div>
                    <div>
                        <label for="category-select" class="text-sm font-semibold text-gray-500 mb-2 block">ì‚¬ì—…ë¶„ì•¼</label>
                        <select id="category-select" class="w-full p-2 border rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            <option value="all">ëª¨ë“  ì‚¬ì—…ë¶„ì•¼</option>
                        </select>
                    </div>
                </div>
                
                <!-- í‚¤ì›Œë“œ ì•Œë¦¼ -->
                <div class="pt-4 border-t">
                     <h3 class="text-sm font-semibold text-gray-500 mb-2">í‚¤ì›Œë“œ ì•Œë¦¼ ì„¤ì • (ë°©ë¬¸ ì‹œ ì•Œë¦¼)</h3>
                     <div class="flex gap-2">
                         <input type="text" id="keyword-input" placeholder="ì•Œë¦¼ë°›ì„ í‚¤ì›Œë“œ ì…ë ¥" class="flex-grow px-3 py-1 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500">
                         <button id="add-keyword-button" class="px-4 py-1 bg-indigo-600 text-white rounded-lg text-sm font-semibold hover:bg-indigo-700">ì¶”ê°€</button>
                     </div>
                     <div id="keyword-tags-container" class="flex flex-wrap gap-2 mt-2 min-h-[34px]"></div>
                </div>

                <!-- í™œì„± í•„í„° -->
                <div id="active-filters-container" class="flex flex-wrap gap-2 items-center pt-4 border-t min-h-[41px]"></div>

                <!-- ë²„íŠ¼ ê·¸ë£¹ -->
                <div id="sort-buttons" class="flex flex-wrap gap-2 items-center justify-center pt-4 border-t">
                    <button data-sort="default" class="control-button active px-4 py-2 border border-gray-300 rounded-lg text-sm font-semibold hover:bg-gray-100">ê¸°ë³¸ìˆœ</button>
                    <button data-sort="deadline" class="control-button px-4 py-2 border border-gray-300 rounded-lg text-sm font-semibold hover:bg-gray-100">ë§ˆê° ì„ë°•ìˆœ</button>
                    <button id="favorites-toggle" class="control-button w-full sm:w-auto px-4 py-2 bg-amber-400 text-white rounded-lg text-sm font-semibold hover:bg-amber-500">â˜† ì¦ê²¨ì°¾ê¸° ë³´ê¸°</button>
                    <button id="compare-button" class="control-button w-full sm:w-auto px-4 py-2 bg-green-500 text-white rounded-lg text-sm font-semibold hover:bg-green-600 hidden">ğŸ“‹ ì„ íƒ í•­ëª© ë¹„êµí•˜ê¸°</button>
                </div>
            </div>

            <!-- ìƒì„¸ í•„í„° í† ê¸€ ë²„íŠ¼ -->
            <div class="text-center border-t pt-4 mt-4">
                <button id="toggle-filters-button" class="text-sm font-semibold text-indigo-600 hover:underline">ìƒì„¸ í•„í„° ë³´ê¸° â–¼</button>
            </div>
        </div>

        <div id="status-container" class="text-center h-64 flex justify-center items-center"><div id="loading-indicator"><div class="loader mx-auto"></div><p class="text-gray-500 mt-4">ìµœì‹  ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p></div><div id="error-message" class="hidden"></div></div>
        <main id="results-container" class="hidden grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></main>
        <div id="load-more-container" class="text-center mt-8 hidden"><button id="load-more-button" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-8 rounded-lg">ë”ë³´ê¸°</button></div>
        <footer class="text-center mt-12 text-sm text-gray-500"><p>ë³¸ ë°ì´í„°ëŠ” ê³µê³µë°ì´í„°í¬í„¸(K-Startup) APIë¥¼ í†µí•´ ì œê³µë°›ì•˜ìŠµë‹ˆë‹¤.</p></footer>
    </div>

    <div id="comparison-modal" class="fixed inset-0 z-50 hidden"><div id="comparison-modal-bg" class="absolute inset-0 bg-black bg-opacity-50"></div><div class="relative bg-white rounded-lg shadow-xl m-4 md:m-8 max-w-6xl mx-auto max-h-[90vh] flex flex-col"><div class="flex justify-between items-center p-4 border-b"><h2 class="text-xl font-bold">ì§€ì›ì‚¬ì—… ë¹„êµí•˜ê¸°</h2><button id="close-modal-button" class="text-2xl">&times;</button></div><div id="comparison-content" class="p-4 overflow-auto"></div></div></div>
    <div id="toast-notification" class="fixed bottom-10 right-10 bg-gray-800 text-white px-6 py-3 rounded-lg shadow-lg opacity-0 transform translate-y-4">ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!</div>
    <div id="keyword-alert-modal" class="fixed inset-0 z-50 hidden bg-black bg-opacity-50 flex justify-center items-center"><div class="bg-white rounded-lg shadow-xl m-4 max-w-lg w-full"><div class="flex justify-between items-center p-4 border-b bg-indigo-500 text-white rounded-t-lg"><h2 class="text-xl font-bold">ğŸ”” ìƒˆë¡œìš´ í‚¤ì›Œë“œ ê³µê³  ì•Œë¦¼!</h2><button id="close-keyword-alert-button" class="text-2xl">&times;</button></div><div id="keyword-alert-content" class="p-6 max-h-[60vh] overflow-y-auto"></div></div></div>
    
    <script>
        const INITIAL_LOAD_COUNT = 12;
        const TOTAL_LOAD_COUNT = 500; 
        let allApiData = [], filteredItems = [], favorites = [], comparisonList = [];
        let visibleItemCount = 12;
        let currentFilters = { searchTerm: '', region: 'all', category: 'all', sort: 'default', showFavorites: false };
        let alertKeywords = [];
        let seenItems = [];

        const elements = { 
            statusContainer: document.getElementById('status-container'), loadingIndicator: document.getElementById('loading-indicator'), errorMessage: document.getElementById('error-message'), resultsContainer: document.getElementById('results-container'), searchInput: document.getElementById('search-input'), sortButtons: document.getElementById('sort-buttons'),
            regionSelect: document.getElementById('region-select'), 
            categorySelect: document.getElementById('category-select'), 
            activeFiltersContainer: document.getElementById('active-filters-container'), favoritesToggle: document.getElementById('favorites-toggle'), compareButton: document.getElementById('compare-button'), loadMoreContainer: document.getElementById('load-more-container'), loadMoreButton: document.getElementById('load-more-button'), modal: document.getElementById('comparison-modal'), modalBg: document.getElementById('comparison-modal-bg'), closeModalButton: document.getElementById('close-modal-button'), comparisonContent: document.getElementById('comparison-content'), toast: document.getElementById('toast-notification'), toggleFiltersButton: document.getElementById('toggle-filters-button'), collapsibleFilters: document.getElementById('collapsible-filters'),
            keywordInput: document.getElementById('keyword-input'), addKeywordButton: document.getElementById('add-keyword-button'), keywordTagsContainer: document.getElementById('keyword-tags-container'), keywordAlertModal: document.getElementById('keyword-alert-modal'), keywordAlertContent: document.getElementById('keyword-alert-content'), closeKeywordAlertButton: document.getElementById('close-keyword-alert-button')
        };

        document.addEventListener('DOMContentLoaded', initialize);

        async function initialize() {
            favorites = JSON.parse(localStorage.getItem('favorites')) || [];
            alertKeywords = JSON.parse(localStorage.getItem('alertKeywords')) || [];
            seenItems = JSON.parse(localStorage.getItem('seenItems')) || [];
            addEventListeners();
            renderAlertKeywords();
            const initialData = await fetchData(INITIAL_LOAD_COUNT);
            if (initialData) {
                allApiData = initialData;
                applyFiltersAndRender();
            }
            const fullData = await fetchData(TOTAL_LOAD_COUNT);
            if (fullData) {
                allApiData = fullData;
                await populateFilters();
                applyFiltersAndRender();
                checkNewItemsForKeywords();
            }
        }
		
		async function fetchData(perPage) {
			const backendApiUrl = `/.netlify/functions/get-support-data?perPage=${perPage}`;
			try {
				const response = await fetch(backendApiUrl);
				if (!response.ok) throw new Error(`ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜: ${response.status}`);
				const data = await response.json();
				if (data && data.data) return data.data;
				throw new Error(data.resultMsg || "ë°±ì—”ë“œë¡œë¶€í„° ìœ íš¨í•œ ë°ì´í„°ë¥¼ ë°›ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
			} catch (error) {
				console.error("ë°ì´í„° ìš”ì²­ ì˜¤ë¥˜:", error);
				elements.loadingIndicator.classList.add('hidden');
				let friendlyMessage = "ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë°±ì—”ë“œ ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.";
				if (error.message.includes("Failed to fetch")) friendlyMessage = "ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì´ ë¶ˆì•ˆì •í•˜ê±°ë‚˜ ë°±ì—”ë“œ ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì£¼ì†Œê°€ ì˜¬ë°”ë¥¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.";
				else friendlyMessage = `ì˜¤ë¥˜ ë°œìƒ: ${error.message}`;
				elements.errorMessage.textContent = friendlyMessage;
				elements.errorMessage.classList.remove('hidden');
				return null;
			}
		}
		
        async function populateFilters() {
            const regionCounts = {}, categoryCounts = {};
            allApiData.forEach(item => {
                if (item.supt_regin) regionCounts[item.supt_regin] = (regionCounts[item.supt_regin] || 0) + 1;
                if (item.supt_biz_clsfc) categoryCounts[item.supt_biz_clsfc] = (categoryCounts[item.supt_biz_clsfc] || 0) + 1;
            });

            const createAndAppendOption = (selectElement, text, value) => {
                const option = document.createElement('option');
                option.value = value;
                option.textContent = text;
                selectElement.appendChild(option);
            };
            
            elements.regionSelect.innerHTML = '<option value="all">ëª¨ë“  ì§€ì—­ ('+ allApiData.length +')</option>';
            
            // *** [ë³€ê²½] ì§€ì—­ ëª©ë¡ì„ ê°€ë‚˜ë‹¤ìˆœìœ¼ë¡œ ì •ë ¬í•˜ëŠ” ë¡œì§ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤ ***
            const sortedRegions = Object.keys(regionCounts).sort((a, b) => a.localeCompare(b, 'ko'));
            
            for (const region of sortedRegions) {
                const count = regionCounts[region];
                createAndAppendOption(elements.regionSelect, `${region} (${count})`, region);
            }
            
            elements.categorySelect.innerHTML = '<option value="all">ëª¨ë“  ì‚¬ì—…ë¶„ì•¼ ('+ allApiData.length +')</option>';
            for (const [category, count] of Object.entries(categoryCounts)) {
                let displayText = category;
                if (category.includes('ê¸°ìˆ ê°œë°œ(R&D)')) {
                    displayText = 'ê¸°ìˆ ê°œë°œ';
                }
                createAndAppendOption(elements.categorySelect, `${displayText} (${count})`, category);
            }
        }

        function addEventListeners() {
            elements.searchInput.addEventListener('input', e => { currentFilters.searchTerm = e.target.value.toLowerCase(); applyFiltersAndRender(); });
            elements.loadMoreButton.addEventListener('click', () => { visibleItemCount += 12; render(); });
            elements.sortButtons.addEventListener('click', e => { if (e.target.tagName === 'BUTTON') { currentFilters.sort = e.target.dataset.sort; updateFilterUI(); applyFiltersAndRender(); } });
            elements.favoritesToggle.addEventListener('click', e => { currentFilters.showFavorites = !currentFilters.showFavorites; e.target.classList.toggle('active'); e.target.innerHTML = currentFilters.showFavorites ? 'â˜… ì „ì²´ ëª©ë¡ ë³´ê¸°' : 'â˜† ì¦ê²¨ì°¾ê¸° ë³´ê¸°'; applyFiltersAndRender(); });
            elements.regionSelect.addEventListener('change', e => { currentFilters.region = e.target.value; applyFiltersAndRender(); });
            elements.categorySelect.addEventListener('change', e => { currentFilters.category = e.target.value; applyFiltersAndRender(); });
            elements.resultsContainer.addEventListener('click', e => { const target = e.target; const button = target.closest('button'); if (button) { if (button.classList.contains('favorite-button')) toggleFavorite(button); if (button.classList.contains('share-button')) shareLink(button); if (button.classList.contains('details-toggle')) toggleDetails(button); } const checkbox = target.closest('.compare-checkbox'); if (checkbox) toggleComparison(checkbox); });
            elements.compareButton.addEventListener('click', showComparisonModal);
            elements.modalBg.addEventListener('click', () => elements.modal.classList.add('hidden'));
            elements.closeModalButton.addEventListener('click', () => elements.modal.classList.add('hidden'));
            elements.toggleFiltersButton.addEventListener('click', () => { const filters = elements.collapsibleFilters; const button = elements.toggleFiltersButton; filters.classList.toggle('expanded'); button.innerHTML = filters.classList.contains('expanded') ? 'ìƒì„¸ í•„í„° ì ‘ê¸° â–²' : 'ìƒì„¸ í•„í„° ë³´ê¸° â–¼'; });
            elements.addKeywordButton.addEventListener('click', addKeyword);
            elements.keywordInput.addEventListener('keypress', e => { if (e.key === 'Enter') addKeyword(); });
            elements.keywordTagsContainer.addEventListener('click', handleKeywordTagClick);
            elements.closeKeywordAlertButton.addEventListener('click', () => elements.keywordAlertModal.classList.add('hidden'));
        }

        function resetFilter(type) {
            if (type === 'searchTerm') {
                elements.searchInput.value = '';
                currentFilters.searchTerm = '';
            } else if (type === 'region') {
                elements.regionSelect.value = 'all';
                currentFilters.region = 'all';
            } else if (type === 'category') {
                elements.categorySelect.value = 'all';
                currentFilters.category = 'all';
            }
            applyFiltersAndRender();
        }

        function resetAllFilters() {
            elements.searchInput.value = '';
            elements.regionSelect.value = 'all';
            elements.categorySelect.value = 'all';
            currentFilters = { ...currentFilters, searchTerm: '', region: 'all', category: 'all' };
            applyFiltersAndRender();
        }

        function updateFilterUI() {
            elements.sortButtons.querySelectorAll('.control-button').forEach(btn => btn.classList.toggle('active', btn.dataset.sort === currentFilters.sort));
            elements.regionSelect.value = currentFilters.region;
            elements.categorySelect.value = currentFilters.category;
        }

        function applyFiltersAndRender() { let items = [...allApiData]; if (currentFilters.showFavorites) items = items.filter(item => favorites.includes(item.pbanc_sn)); if (currentFilters.searchTerm) items = items.filter(item => (item.biz_pbanc_nm || '').toLowerCase().includes(currentFilters.searchTerm) || (item.pbanc_ntrp_nm || '').toLowerCase().includes(currentFilters.searchTerm)); if (currentFilters.region !== 'all') items = items.filter(item => item.supt_regin === currentFilters.region); if (currentFilters.category !== 'all') items = items.filter(item => item.supt_biz_clsfc === currentFilters.category); if (currentFilters.sort === 'deadline') items.sort((a, b) => calculateDday(a.pbanc_rcpt_end_dt).days - calculateDday(b.pbanc_rcpt_end_dt).days); filteredItems = items; visibleItemCount = 12; render(); }
        function render() { elements.statusContainer.classList.add('hidden'); elements.resultsContainer.classList.remove('hidden'); renderActiveFilters(); if (filteredItems.length === 0) { elements.resultsContainer.innerHTML = `<p class="col-span-full text-center text-gray-500">${currentFilters.showFavorites ? 'ì¦ê²¨ì°¾ê¸°í•œ ì‚¬ì—…ì´ ì—†ìŠµë‹ˆë‹¤.' : 'ì¡°ê±´ì— ë§ëŠ” ì‚¬ì—…ì´ ì—†ìŠµë‹ˆë‹¤.'}</p>`; } else { displayData(filteredItems.slice(0, visibleItemCount)); } elements.loadMoreContainer.style.display = filteredItems.length > visibleItemCount ? 'block' : 'none'; }
        function displayData(items) { elements.resultsContainer.innerHTML = items.map(item => { const dday = calculateDday(item.pbanc_rcpt_end_dt); const isFavorited = favorites.includes(item.pbanc_sn); const isChecked = comparisonList.includes(item.pbanc_sn) ? 'checked' : ''; const isNew = isWithinLast7Days(item.pbanc_rcpt_bgng_dt); return ` <div class="bg-white rounded-xl shadow-md overflow-hidden relative"> ${isNew ? '<span class="new-badge absolute top-0 right-0 bg-red-500 text-white text-xs font-bold px-2 py-1 rounded-bl-lg">NEW</span>' : ''} <div class="p-6"> <div class="flex justify-between items-start"><span class="text-sm font-semibold text-indigo-600 uppercase tracking-wide">${item.pbanc_ntrp_nm || 'ê¸°ê´€ëª… ì—†ìŒ'}</span><span class="text-white text-xs font-bold rounded-full px-3 py-1 ${dday.className}">${dday.text}</span></div> <a href="${item.detl_pg_url}" target="_blank" class="block mt-2 text-xl leading-tight font-bold text-black hover:underline">${item.biz_pbanc_nm || 'ê³µê³  ì œëª© ì—†ìŒ'}</a> <p class="mt-2 text-gray-500 text-sm"><strong>ì ‘ìˆ˜ê¸°ê°„:</strong> ${item.pbanc_rcpt_bgng_dt || '?'} ~ ${item.pbanc_rcpt_end_dt || '?'}</p> <div class="details-content mt-4 pt-4 border-t text-sm text-gray-600 space-y-2"> <p><strong>- ì‹ ì²­ëŒ€ìƒ:</strong> ${item.aply_trgt_ctnt || 'ìƒì„¸ ì •ë³´ ì—†ìŒ'}</p> </div> <div class="flex justify-between items-center mt-4 pt-4 border-t"> <div class="flex items-center gap-4"> <label class="flex items-center space-x-2 text-sm cursor-pointer"><input type="checkbox" class="compare-checkbox" data-id="${item.pbanc_sn}" ${isChecked}><span>ë¹„êµ</span></label> <button class="details-toggle text-sm font-semibold text-indigo-600 hover:underline">ìì„¸íˆ ë³´ê¸° â–¼</button> </div> <div> <button class="share-button text-gray-400 hover:text-indigo-500" data-url="${item.detl_pg_url}" title="ê³µìœ í•˜ê¸°"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12s-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6.002l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.318a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"></path></svg></button> <button class="favorite-button text-2xl text-gray-400 hover:text-amber-400 ${isFavorited ? 'favorited' : ''}" data-id="${item.pbanc_sn}">${isFavorited ? 'â˜…' : 'â˜†'}</button> </div> </div> </div> </div>`; }).join(''); }
        function renderActiveFilters() { let html = ''; if (currentFilters.searchTerm) html += `<span class="active-filter-tag" data-type="searchTerm">ê²€ìƒ‰: ${currentFilters.searchTerm} <button>x</button></span>`; if (currentFilters.region !== 'all') html += `<span class="active-filter-tag" data-type="region">ì§€ì—­: ${currentFilters.region} <button>x</button></span>`; if (currentFilters.category !== 'all') html += `<span class="active-filter-tag" data-type="category">ë¶„ì•¼: ${currentFilters.category} <button>x</button></span>`; if (html) { html += `<button id="reset-filters-button" class="text-sm text-red-500 hover:underline ml-auto">ëª¨ë“  í•„í„° ì´ˆê¸°í™”</button>`; } elements.activeFiltersContainer.innerHTML = html; elements.activeFiltersContainer.querySelectorAll('.active-filter-tag button').forEach(btn => btn.addEventListener('click', e => { const type = e.target.parentElement.dataset.type; resetFilter(type); })); if(document.getElementById('reset-filters-button')) { document.getElementById('reset-filters-button').addEventListener('click', resetAllFilters); } }
        function calculateDday(endDateStr) { if (!endDateStr) return { text: "ì •ë³´ ì—†ìŒ", className: "bg-gray-500", days: 9999 }; const year = parseInt(endDateStr.substring(0, 4)), month = parseInt(endDateStr.substring(4, 6)) - 1, day = parseInt(endDateStr.substring(6, 8)); const today = new Date(); today.setHours(0, 0, 0, 0); const endDate = new Date(year, month, day); const diffDays = Math.ceil((endDate - today) / (1000 * 60 * 60 * 24)); if (diffDays < 0) return { text: "ë§ˆê°", className: "bg-gray-700", days: 9999 + diffDays }; if (diffDays === 0) return { text: "D-Day", className: "bg-red-500", days: 0 }; if (diffDays <= 7) return { text: `D-${diffDays}`, className: "bg-orange-500", days: diffDays }; return { text: `D-${diffDays}`, className: "bg-green-600", days: diffDays }; }
        function isWithinLast7Days(dateStr) { if (!dateStr) return false; const year = parseInt(dateStr.substring(0, 4)), month = parseInt(dateStr.substring(4, 6)) - 1, day = parseInt(dateStr.substring(6, 8)); const itemDate = new Date(year, month, day); const today = new Date(); const sevenDaysAgo = new Date(); sevenDaysAgo.setDate(today.getDate() - 7); return itemDate >= sevenDaysAgo && itemDate <= today; }
        function toggleDetails(button) { const content = button.closest('.p-6').querySelector('.details-content'); content.classList.toggle('expanded'); button.textContent = content.classList.contains('expanded') ? 'ê°„ëµíˆ ë³´ê¸° â–²' : 'ìì„¸íˆ ë³´ê¸° â–¼'; }
        function toggleFavorite(button) { const id = parseInt(button.dataset.id); const index = favorites.indexOf(id); if (index > -1) { favorites.splice(index, 1); button.classList.remove('favorited'); button.textContent = 'â˜†'; } else { favorites.push(id); button.classList.add('favorited'); button.textContent = 'â˜…'; } localStorage.setItem('favorites', JSON.stringify(favorites)); if (currentFilters.showFavorites) applyFiltersAndRender(); }
        function toggleComparison(checkbox) { const id = parseInt(checkbox.dataset.id); const index = comparisonList.indexOf(id); if (index > -1) comparisonList.splice(index, 1); else comparisonList.push(id); elements.compareButton.style.display = comparisonList.length > 0 ? 'block' : 'none'; }
        function showComparisonModal() { const itemsToCompare = allApiData.filter(item => comparisonList.includes(item.pbanc_sn)); const headers = { biz_pbanc_nm: "ê³µê³  ì œëª©", pbanc_ntrp_nm: "ì£¼ê´€ ê¸°ê´€", supt_regin: "ì§€ì› ì§€ì—­", supt_biz_clsfc: "ì‚¬ì—… ë¶„ì•¼", aply_trgt_ctnt: "ì‹ ì²­ ëŒ€ìƒ" }; let tableHTML = '<div class="overflow-x-auto"><table class="w-full text-sm text-left table-fixed"><thead><tr class="bg-gray-100"><th class="p-2 w-1/5">í•­ëª©</th>'; itemsToCompare.forEach(item => tableHTML += `<th class="p-2 w-2/5">${(item.biz_pbanc_nm || '').substring(0, 20)}...</th>`); tableHTML += '</tr></thead><tbody>'; Object.keys(headers).forEach(key => { tableHTML += `<tr class="border-b"><td class="font-bold p-2 align-top">${headers[key]}</td>`; itemsToCompare.forEach(item => tableHTML += `<td class="p-2 align-top break-words">${item[key] || '-'}</td>`); tableHTML += '</tr>'; }); tableHTML += '</tbody></table></div>'; elements.comparisonContent.innerHTML = tableHTML; elements.modal.classList.remove('hidden'); }
        function shareLink(button) { const url = button.dataset.url; const textArea = document.createElement("textarea"); textArea.value = url; document.body.appendChild(textArea); textArea.focus(); textArea.select(); try { document.execCommand('copy'); showToast("ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!"); } catch (err) { showToast("ë§í¬ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.", true); } document.body.removeChild(textArea); }
        function showToast(message, isError = false) { elements.toast.textContent = message; elements.toast.className = `fixed bottom-10 right-10 text-white px-6 py-3 rounded-lg shadow-lg opacity-0 transform translate-y-4 ${isError ? 'bg-red-500' : 'bg-gray-800'}`; elements.toast.classList.remove('opacity-0', 'translate-y-4'); setTimeout(() => { elements.toast.classList.add('opacity-0', 'translate-y-4'); }, 2000); }
        function addKeyword() { const keyword = elements.keywordInput.value.trim(); if (keyword && !alertKeywords.includes(keyword)) { alertKeywords.push(keyword); localStorage.setItem('alertKeywords', JSON.stringify(alertKeywords)); renderAlertKeywords(); elements.keywordInput.value = ''; } }
        function renderAlertKeywords() { if (alertKeywords.length === 0) { elements.keywordTagsContainer.innerHTML = '<span class="text-xs text-gray-400">ì•Œë¦¼ ë°›ì„ í‚¤ì›Œë“œë¥¼ ì¶”ê°€í•´ë³´ì„¸ìš”.</span>'; return; } elements.keywordTagsContainer.innerHTML = alertKeywords.map((keyword, index) => ` <span class="keyword-tag">${keyword} <button data-index="${index}">x</button></span> `).join(''); }
        function handleKeywordTagClick(e) { if (e.target.tagName === 'BUTTON') { const index = parseInt(e.target.dataset.index); alertKeywords.splice(index, 1); localStorage.setItem('alertKeywords', JSON.stringify(alertKeywords)); renderAlertKeywords(); } }
        function checkNewItemsForKeywords() { if (alertKeywords.length === 0 || allApiData.length === 0) return; const currentItemIds = allApiData.map(item => item.pbanc_sn); const newItems = allApiData.filter(item => !seenItems.includes(item.pbanc_sn)); if (newItems.length > 0) { const matchedItems = []; newItems.forEach(item => { const title = item.biz_pbanc_nm || ''; const matchedKeyword = alertKeywords.find(keyword => title.toLowerCase().includes(keyword.toLowerCase())); if (matchedKeyword) { matchedItems.push({ item, keyword: matchedKeyword }); } }); if (matchedItems.length > 0) { showKeywordAlertDialog(matchedItems); } } localStorage.setItem('seenItems', JSON.stringify(currentItemIds)); seenItems = currentItemIds; }
        function showKeywordAlertDialog(matchedItems) { elements.keywordAlertContent.innerHTML = matchedItems.map(({item, keyword}) => ` <div class="mb-4 p-3 border rounded-lg hover:bg-gray-50"> <p class="text-sm text-gray-500"> <span class="font-bold text-indigo-600">[${keyword}]</span> í‚¤ì›Œë“œì™€ ì¼ì¹˜í•˜ëŠ” ìƒˆ ê³µê³ ! </p> <a href="${item.detl_pg_url}" target="_blank" class="font-bold text-gray-800 hover:underline">${item.biz_pbanc_nm}</a> </div> `).join(''); elements.keywordAlertModal.classList.remove('hidden'); }
    </script>
</body>
</html>