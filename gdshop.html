<!DOCTYPE html>
<html>
<head>
    <title>GD Shop - 우리 동네 착한가격업소</title>
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=bdae71c83941e7abbe59827c2625be7b"></script>
</head>
<body>

    <h1>GD Shop - 우리 동네 착한가격업소 🗺️</h1>
    <p>아래 버튼을 눌러 내 주변의 착한 가게를 찾아보세요!</p>
    <button id="find-btn">내 위치 찾기!</button>
    
    <div id="map" style="width:100%; height:400px; margin-top: 20px;"></div>

    <script>
        // ==========================================================
        // V1.3 업데이트: 샘플 가게 데이터를 추가합니다.
        // 나중에는 이 부분을 실제 데이터 파일에서 읽어오도록 바꿀 거예요!
        const gdShopData = [
            {
                name: '착한 중국집',
                lat: 37.4210, 
                lng: 127.1290 
            },
            {
                name: '정직한 미용실',
                lat: 37.4225,
                lng: 127.1275
            },
            {
                name: '성실한 밥집',
                lat: 37.4195,
                lng: 127.1288
            }
        ];
        // ==========================================================

        const findBtn = document.getElementById('find-btn');
        findBtn.addEventListener('click', findMyLocation);

        function findMyLocation() {
            const mapContainer = document.getElementById('map');
            mapContainer.innerHTML = "위치를 찾는 중..."; 

            navigator.geolocation.getCurrentPosition(success, error);
        }

        function success(position) {
            const latitude = position.coords.latitude;
            const longitude = position.coords.longitude;
            
            console.log('✅ 위치 정보 얻기 성공!', { latitude, longitude });

            const mapContainer = document.getElementById('map'); 
            const mapOption = { 
                center: new kakao.maps.LatLng(latitude, longitude),
                level: 5 // 가게들이 잘 보이도록 지도를 조금 더 축소!
            };

            const map = new kakao.maps.Map(mapContainer, mapOption); 

            // 1. 내 위치에 마커 표시하기
            const myMarkerPosition  = new kakao.maps.LatLng(latitude, longitude); 
            const myMarker = new kakao.maps.Marker({
                position: myMarkerPosition
            });
            myMarker.setMap(map);

            // ================================================================
            // V1.3 업데이트: 샘플 가게 데이터를 순회하며 마커를 표시합니다.
            gdShopData.forEach((shop) => {
                // 가게의 위치 좌표를 생성합니다.
                const shopPosition = new kakao.maps.LatLng(shop.lat, shop.lng);

                // 가게 마커를 생성합니다.
                const shopMarker = new kakao.maps.Marker({
                    position: shopPosition
                });

                // 지도에 가게 마커를 표시합니다.
                shopMarker.setMap(map);

                // --- 🐛 개발자 디버깅 툴 ---
                console.log(`📍 ${shop.name} 마커 표시 완료!`);
                // --------------------------
            });
            // ================================================================
        }

        function error() {
            const mapContainer = document.getElementById('map');
            mapContainer.innerHTML = "죄송합니다. 위치 정보를 가져올 수 없습니다.";
            console.error('❌ 위치 정보 얻기 실패!');
        }
    </script>

</body>
</html>