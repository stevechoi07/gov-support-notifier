<!DOCTYPE html>
<html>
<head>
    <title>GD Shop - ìš°ë¦¬ ë™ë„¤ ì°©í•œê°€ê²©ì—…ì†Œ</title>
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=bdae71c83941e7abbe59827c2625be7b"></script>
    <style>
        /* ëª©ë¡ ìŠ¤íƒ€ì¼ì„ ì‚´ì§ ê¾¸ë©°ì¤ë‹ˆë‹¤ */
        #shop-list {
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        #shop-list .shop-item {
            padding: 8px;
            cursor: pointer;
            border-bottom: 1px solid #eee;
        }
        #shop-list .shop-item:hover {
            background-color: #f9f9f9;
        }
        #shop-list .shop-item:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body>

    <h1>v1.6 GD Shop - ìš°ë¦¬ ë™ë„¤ ì°©í•œê°€ê²©ì—…ì†Œ ğŸ—ºï¸</h1>
    <p>ì•„ë˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ ë‚´ ì£¼ë³€ì˜ ì°©í•œ ê°€ê²Œë¥¼ ì°¾ì•„ë³´ì„¸ìš”!</p>
    <button id="find-btn">ë‚´ ìœ„ì¹˜ ì°¾ê¸°!</button>
    
    <div id="map" style="width:100%; height:400px; margin-top: 20px;"></div>

    <div id="shop-list"></div>

    <script>
        const findBtn = document.getElementById('find-btn');
        findBtn.addEventListener('click', findMyLocation);

        function findMyLocation() {
            document.getElementById('map').innerHTML = "ìœ„ì¹˜ë¥¼ ì°¾ëŠ” ì¤‘..."; 
            navigator.geolocation.getCurrentPosition(success, error);
        }

        function success(position) {
            const latitude = position.coords.latitude;
            const longitude = position.coords.longitude;
            const mapContainer = document.getElementById('map'); 
            const mapOption = { 
                center: new kakao.maps.LatLng(latitude, longitude),
                level: 7
            };
            const map = new kakao.maps.Map(mapContainer, mapOption); 

            const myMarker = new kakao.maps.Marker({
                position: new kakao.maps.LatLng(latitude, longitude)
            });
            myMarker.setMap(map);
            
            fetch('data.json')
                .then(response => response.json())
                .then(data => {
                    console.log('âœ… data.json íŒŒì¼ ë¡œë”© ì„±ê³µ!', data);

                    const shopList = document.getElementById('shop-list');
                    shopList.innerHTML = ''; // ëª©ë¡ ì´ˆê¸°í™”

                    // V1.6 ì—…ë°ì´íŠ¸: ë§ˆì»¤ì™€ ì¸í¬ìœˆë„ìš°ë¥¼ ê´€ë¦¬í•  ë°°ì—´ ìƒì„±
                    const markers = [];
                    const infowindows = [];

                    data.forEach((shop, index) => {
                        // ë§ˆì»¤ ìƒì„± ë° ë°°ì—´ì— ì¶”ê°€
                        const marker = new kakao.maps.Marker({
                            position: new kakao.maps.LatLng(shop.lat, shop.lng)
                        });
                        marker.setMap(map);
                        markers.push(marker);

                        // ì¸í¬ìœˆë„ìš° ìƒì„± ë° ë°°ì—´ì— ì¶”ê°€
                        const infowindow = new kakao.maps.InfoWindow({
                            content : `<div style="padding:5px; font-size:14px;">${shop.name}</div>`,
                            removable : true
                        });
                        infowindows.push(infowindow);

                        // ë§ˆì»¤ í´ë¦­ ì´ë²¤íŠ¸
                        kakao.maps.event.addListener(marker, 'click', function() {
                            infowindows.forEach(iw => iw.close()); // ë‹¤ë¥¸ ì¸í¬ìœˆë„ìš° ë‹«ê¸°
                            infowindow.open(map, marker);  
                        });

                        // V1.6 ì—…ë°ì´íŠ¸: ê°€ê²Œ ëª©ë¡ ì•„ì´í…œ ìƒì„±
                        const listItem = document.createElement('div');
                        listItem.className = 'shop-item';
                        listItem.innerHTML = `<b>${shop.name}</b><br><small>${shop.address}</small>`;
                        
                        // ëª©ë¡ ì•„ì´í…œ í´ë¦­ ì´ë²¤íŠ¸
                        listItem.addEventListener('click', function() {
                            infowindows.forEach(iw => iw.close()); // ë‹¤ë¥¸ ì¸í¬ìœˆë„ìš° ë‹«ê¸°
                            infowindow.open(map, marker);
                            map.panTo(marker.getPosition()); // ì§€ë„ë¥¼ ë§ˆì»¤ ìœ„ì¹˜ë¡œ ë¶€ë“œëŸ½ê²Œ ì´ë™
                        });
                        
                        shopList.appendChild(listItem);
                    });
                })
                .catch(error => console.error('âŒ data.json íŒŒì¼ ë¡œë”© ì‹¤íŒ¨!', error));
        }

        function error() {
            document.getElementById('map').innerHTML = "ì£„ì†¡í•©ë‹ˆë‹¤. ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
            console.error('âŒ ìœ„ì¹˜ ì •ë³´ ì–»ê¸° ì‹¤íŒ¨!');
        }
    </script>
</body>
</html>